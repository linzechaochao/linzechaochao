<!DOCTYPE html>
<html>

<head>
    <title>FATE 实例</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/css/fileinput.min.css" media="all"
        rel="stylesheet" type="text/css" />
    <!-- if using RTL (Right-To-Left) orientation, load the RTL CSS file after fileinput.css by uncommenting below -->
    <!-- link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/css/fileinput-rtl.min.css" media="all" rel="stylesheet" type="text/css" /-->
    <!-- the font awesome icon library if using with `fas` theme (or Bootstrap 4.x or 5.x). Note that default icons used in the plugin are glyphicons that are bundled only with Bootstrap 3.x. -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css" /> -->


    <style>
        body,
        html {
            height: 100%;
            padding: 0;
            margin: 0;
        }

        a:link {
            display: block;
            color: #000;
            padding: 8px 16px;
            text-decoration: none;
        }



        a:visited {
            text-decoration: none;
        }

        a:hover {
            /* text-decoration: none; */
            /* color: #FF0000; */
            background-color: #555;
            color: white;
        }

        a:active {
            /* text-decoration: none; */
            /* background-color: #4CAF50; */
            color: white;
        }

        nav-tabs {
            border-bottom: none;
        }

        .col-xs-1-10,
        .col-sm-1-10,
        .col-md-1-10,
        .col-lg-1-10 {
            min-height: 1px;
            padding-left: 15px;
            padding-right: 15px;
            position: relative;
        }

        .col-xs-1-10 {
            width: 10%;
            float: left;
        }

        @media (min-width: 768px) {
            .col-sm-1-10 {
                width: 10%;
                float: left;
            }
        }

        @media (min-width: 992px) {
            .col-md-1-10 {
                width: 10%;
                float: left;
            }
        }

        @media (min-width: 1200px) {
            .col-lg-1-10 {
                width: 10%;
                float: left;
            }
        }



        .nav_side_left {
            background-color: rgb(204, 204, 204);
            min-height: 648px;
            max-height: 1280px;
            overflow: auto;
        }

        .nav_side_right {
            width: 100%;
            min-height: 648px;
            max-height: 1280px;
            background-color: rgb(255, 255, 255);

        }


        #label_sty {
            font-size: 18px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 500;
            padding-left: 10px;
            text-align: right;

        }

        #sub_btn {
            float: right;
            background-color: rgb(72, 181, 0);
            color: white;
            text-align: center;

        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12" style="padding-left: 0px;padding-right: 0px;">
                <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
                    <ul class="navbar-nav nav justify-content-center">
                        <li class="nav-item active">
                            <a class="nav-link navbar-brand" href="#"><img src="img\favicon.png"
                                    style="display:inline-block;height: 28px;">&nbsp;&nbsp;
                                <span class="navbar-text">FATE可视化</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="#">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
                                    class="navbar-text">连线选择&nbsp;</span>
                                <select id="sel_linetype" style="display:inline-block">
                                    <option value="1">折线</option>
                                    <option value="2">直线</option>
                                    <option value="3">曲线</option>
                                </select>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><button class="btn btn-secondary" id="save_btn">保存</button></a>

                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><button class="btn btn-secondary"
                                    id="clear_btn">清空画布</button></a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="#"><button class="btn btn-secondary" id="product_json_btn"
                                    onclick="getjson()">生成json文件</button></a>
                        </li>
                    </ul>
                </nav>

            </div>

        </div>

        <div class="row">
            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 nav_side_left">

                <ul class="nav nav-tabs" role="tablist" style="margin-top: 5px;margin-bottom: 5px;">
                    <li class="nav-item">
                        <div class="btn-group dropright">
                            <button type="button" class="btn btn-secondary btn-lg btn-block">
                                &nbsp;&nbsp;功&nbsp;&nbsp;能&nbsp;&nbsp;类&nbsp;&nbsp;型&nbsp;&nbsp;
                            </button>
                            <!-- <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                &nbsp;&nbsp;功&nbsp;&nbsp;能&nbsp;&nbsp;类&nbsp;&nbsp;型&nbsp;&nbsp;
                              </button> -->
                            <button type="button" class="btn btn-secondary  dropdown-toggle dropdown-toggle-split"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">功&nbsp;能&nbsp;类&nbsp;型</span>
                            </button>
                            <div class="dropdown-menu">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="dropdown-item nav-link" data-toggle="tab" href="#Upload_data"
                                            id="Upload_data_a">Upload_data</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="dropdown-item nav-link" data-toggle="tab" href="#Homo"
                                            id="Homo_a">Homo
                                            Algorith</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="dropdown-item nav-link" data-toggle="tab" href="#Hetero"
                                            id="Hetero_a">Hetero
                                            Algorith</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>

                </ul>


                <!-- Tab panes -->
                <div class="tab-content">

                    <div id="Homo" class="tab-pane fade"><br>
                        <div id="Homo_accordion">
                            <div class="card">
                                <div class="card-header">
                                    <a class="card-link" data-toggle="collapse" href="#homo_collapseOne">
                                        Load data
                                    </a>
                                </div>
                                <div id="homo_collapseOne" class="collapse show" data-parent="#Homo_accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="Reader">
                                            Reader
                                        </div>
                                    </a>

                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#homo_collapseTwo">
                                        Data Transform
                                    </a>
                                </div>
                                <div id="homo_collapseTwo" class="collapse" data-parent="#Homo_accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="DataIO">
                                            DataIO
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#homo_collapseThree">
                                        Feature Engineering
                                    </a>
                                </div>
                                <div id="homo_collapseThree" class="collapse" data-parent="#Homo_accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="FeatureScale">
                                            FeatureScale
                                        </div>
                                    </a>
                                    <a href="#">

                                        <div class="card-body draggable_ui ui-widget-content" id="HomoOneHotEncoder">
                                            HomoOneHotEncoder
                                        </div>
                                    </a>
                                </div>


                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#homo_collapseFour">
                                        Homo Fedlearing
                                    </a>
                                </div>
                                <div id="homo_collapseFour" class="collapse" data-parent="#Homo_accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HomoLR">
                                            HomoLR
                                        </div>
                                    </a>

                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HomoSecureboost">
                                            HomoSecureboost
                                        </div>
                                    </a>

                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HomoNN">
                                            HomoNN
                                        </div>
                                    </a>

                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#homo_collapseFive">
                                        Model Evaluation
                                    </a>
                                </div>
                                <div id="homo_collapseFive" class="collapse" data-parent="#Homo_accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="Evaluation">
                                            Evaluation
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="Hetero" class=" tab-pane fade"><br>
                        <div id="accordion">
                            <div class="card">
                                <div class="card-header">
                                    <a class="card-link" data-toggle="collapse" href="#collapseOne">
                                        Load data
                                    </a>
                                </div>
                                <div id="collapseOne" class="collapse show" data-parent="#accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="Reader">
                                            Reader
                                        </div>
                                    </a>

                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#collapseTwo">
                                        Data Transform
                                    </a>
                                </div>
                                <div id="collapseTwo" class="collapse" data-parent="#accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="DataIO">
                                            DataIO
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#collapseThree">
                                        Feature Engineering
                                    </a>
                                </div>
                                <div id="collapseThree" class="collapse" data-parent="#accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="Interssection">
                                            Interssection
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HomoPearson">
                                            HomoPearson
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content"
                                            id="HeteroFeatureSelection">
                                            HeteroFeatureSelection
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#collapseFour">
                                        Hetero Fedlearing
                                    </a>
                                </div>
                                <div id="collapseFour" class="collapse" data-parent="#accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HomoPoisson">
                                            HomoPoisson
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HeteroLR">
                                            HeteroLR
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HeteroNN">
                                            HeteroNN
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HeteroKmeans">
                                            HeteroKmeans
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HeteroLinR">
                                            HeteroLinR
                                        </div>
                                    </a>
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="HeteroSecureboost">
                                            HeteroSecureboost
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <a class="collapsed card-link" data-toggle="collapse" href="#collapseFive">
                                        Model Evaluation
                                    </a>
                                </div>
                                <div id="collapseFive" class="collapse" data-parent="#accordion">
                                    <a href="#">
                                        <div class="card-body draggable_ui ui-widget-content" id="Evaluation">
                                            Evaluation
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10 nav_side_right" id="content">
                <!-- <input type="file" id="poiFile" style="display: none;" /> -->

                <div id="Upload_data" class="tab-pane fade tab-content"><br>
                    <form class="form-horizontal was-validated" id="myForm" method="POST"
                        style="margin-top: 10px;margin-bottom: 0px">
                        <div class="form-group row" id="form_gro">
                            <label for="table_name" class="col-sm-2 col-form-label" id="label_sty">table_name</label>
                            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id="input_sty">
                                <input type="text" class="form-control is-valid" name="table_name" id="table_name"
                                    required>
                            </div>

                            <!-- <div class="invalid-feedback">请填写table_name</div>
                            <div class="valid-feedback">已填写</div> -->
                        </div>

                        <div class="form-group row" id="form_gro">
                            <label for="namespace" class="col-sm-2 col-form-label" id="label_sty">namespace</label>
                            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id="input_sty">

                                <select class="form-control custom-select" name="namespace" id="namespace" required>
                                    <option value="" id="opt_val_0">-- 请选择 --</option>
                                    <option value="experiment" id="opt_val_1">experiment</option>
                                    <option value="2" id="opt_val_2">experiment</option>
                                    <option value="3" id="opt_val_3">experiment</option>
                                    <option value="4" id="opt_val_4">experiment</option>
                                </select>
                                <!-- <div class="invalid-feedback">请选择</div>
                                <div class="valid-feedback">已选择</div> -->
                            </div>
                        </div>

                        <div class="form-group row" id="form_gro">
                            <label for="input_id" class="col-sm-2 col-form-label" id="label_sty">file_path</label>
                            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id="input_sty">
                                <input id="input_id" name="file_path" type="file" class="form-control file file-loading"
                                    data-show-preview="false" data-allowed-file-extensions='["csv"]' required>
                            </div>
                        </div>

                        <div class="form-group row" id="form_gro">
                            <label for="errorBlock" class="col-sm-2 col-form-label" id="label_sty"></label>

                            <div id="errorBlock" class="col-sm-offset-3 col-xs-6 col-sm-6 col-md-6 col-lg-6 help-block">
                            </div>
                        </div>

                        <div class="form-group row" style="margin-bottom: 10px;">
                            <div class="col-sm-offset-9 col-sm-10" id="input_sty" style="padding-bottom: 5px;">
                                <button class="btn" id="sub_btn">确认</button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="reader" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Reader</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" id="reader_Form" action="{{url_for('#')}}" method="POST"
                            style="margin-top: 10px;margin-bottom: 0px">

                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label" id="label_sty"><span
                                        style="font-weight:bolder">Host</span></label>
                            </div>

                            <div class="form-group row" id="form_gro" style="display: none;">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">module_id</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="reader_module_id"
                                        id="reader_module_id" value="">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">name</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="reader_name" id="Host_reader_name"
                                        value="give_credit_hetero_host">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label class="col-sm-3 col-form-label" id="label_sty">namespace</label>
                                <div class="col-sm-8" id="input_sty">

                                    <select class="form-control" name="reader_namespace" id="Host_reader_namespace">
                                        <option value="0" id="reader_opt_val_0">-- 请选择 --</option>
                                        <option value="experiment" id="reader_opt_val_1" selected>experiment</option>
                                    </select>

                                </div>
                            </div>

                            <div class="form-group row">
                                <div style="border:1px solid black;background-color: #555;"
                                    class="col-sm-12 col-form-label"></div>
                            </div>

                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label" id="label_sty"><span
                                        style="font-weight:bolder">Guest</span></label>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">name</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="reader_name" id="Guest_reader_name"
                                        value="give_credit_hetero_guest">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label class="col-sm-3 col-form-label" id="label_sty">namespace</label>
                                <div class="col-sm-8" id="input_sty">

                                    <select class="form-control" name="reader_namespace" id="Guest_reader_namespace">
                                        <option value="0" id="reader_opt_val_0">-- 请选择 --</option>
                                        <option value="experiment" id="reader_opt_val_1" selected>experiment</option>
                                    </select>

                                </div>
                            </div>

                            <div class="form-group row">
                                <div style="border:1px solid black;background-color: #555;"
                                    class="col-sm-12 col-form-label"></div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 control-label col-form-label"
                                    id="label_sty">filepath</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="file" class="form-control" name="reader_save_filepath"
                                        id="reader_save_filepath">
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="reader_btn"
                            onclick="getbtn(this.id)">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="dataio" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">DataIO</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" id="dataio_Form" action="{{url_for('#')}}" method="POST"
                            style="margin-top: 10px;margin-bottom: 0px">

                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label" id="label_sty"><span
                                        style="font-weight:bolder">Host</span></label>
                            </div>

                            <div class="form-group row" id="form_gro" style="display: none;">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">module_id</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="dataio_module_id"
                                        id="dataio_module_id" value="">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label class="col-sm-3 control-label col-form-label" id="label_sty">with_label</label>
                                <div class="col-sm-8" id="input_sty">

                                    <select class="form-control" name="dataio_namespace" id="Host_dataio_namespace">
                                        <option value="0" id="dataio_opt_val_0">-- 请选择 --</option>
                                        <option value="true" id="dataio_opt_val_1">true</option>
                                        <option value="false" id="dataio_opt_val_2" selected>false</option>

                                    </select>

                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">output_format</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="Host_dataio_output_format"
                                        id="Host_dataio_output_format" value="dense">
                                </div>
                            </div>

                            <div class="form-group row">
                                <div style="border:1px solid black;background-color: #555;"
                                    class="col-sm-12 col-form-label"></div>
                            </div>

                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label" id="label_sty"><span
                                        style="font-weight:bolder">Guest</span></label>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label class="col-sm-3 control-label col-form-label" id="label_sty">with_label</label>
                                <div class="col-sm-8" id="input_sty">

                                    <select class="form-control" name="dataio_namespace" id="Guest_dataio_namespace">
                                        <option value="0" id="dataio_opt_val_0">-- 请选择 --</option>
                                        <option value="true" id="dataio_opt_val_1" selected>true</option>
                                        <option value="false" id="dataio_opt_val_2">false</option>

                                    </select>

                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">output_format</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="Guest_dataio_output_format"
                                        id="Guest_dataio_output_format" value="dense">
                                </div>
                            </div>

                            <div class="form-group row">
                                <div style="border:1px solid black;background-color: #555;"
                                    class="col-sm-12 col-form-label"></div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 control-label col-form-label"
                                    id="label_sty">filepath</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="file" class="form-control" name="dataio_save_filepath"
                                        id="dataio_save_filepath">
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="dataio_btn"
                            onclick="getbtn(this.id)">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="heterolr" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Heterolr</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="height:500px; overflow:auto;">
                        <form class="form-horizontal" id="heterolr_Form" action="{{url_for('#')}}" method="POST"
                            style="margin-top: 10px;margin-bottom: 0px;">

                            <div class="form-group row" id="form_gro" style="display: none;">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">module_id</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_module_id"
                                        id="heterolr_module_id" value="">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">penalty</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_penalty"
                                        id="heterolr_penalty" value="L2">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">tol</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_tol" id="heterolr_tol"
                                        value="0.0001">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">alpha</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_alpha" id="heterolr_alpha"
                                        value="0.01">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">optimizer</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_optimizer"
                                        id="heterolr_optimizer" value="rmsprop">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">batch_size</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_batch_size"
                                        id="heterolr_batch_size" value="-1">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">learning_rate</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_learning_rate"
                                        id="heterolr_learning_rate" value="0.15">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">max_iter</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_max_iter"
                                        id="heterolr_max_iter" value="30">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">early_stop</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="heterolr_early_stop"
                                        id="heterolr_early_stop" value="diff">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">init_param</label>
                                <div class="form-group row">
                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="init_method">init_method</label>
                                        <input type="text" class="form-control" id="init_method" value="zeros">
                                    </div>

                                </div>
                            </div>

                            <div class="form-group">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">cv_param</label>
                                <div class="form-group row">
                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="n_splits">n_splits</label>
                                        <input type="text" class="form-control" id="n_splits" value="5">
                                    </div>
                                    <div class="form-group col-md-8 offset-md-3">
                                        <label for="shuffle">shuffle</label>
                                        <select id="shuffle" class="form-control">
                                            <option value="true">true</option>
                                            <option value="false" selected>false</option>
                                        </select>
                                    </div>
                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="random_seed">random_seed</label>
                                        <input type="text" class="form-control" id="random_seed" value="103">
                                    </div>

                                    <div class="form-group col-md-8 offset-md-3">
                                        <label for="need_cv">need_cv</label>
                                        <select id="need_cv" class="form-control">
                                            <option value="true">true</option>
                                            <option value="false" selected>false</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">sqn_param</label>
                                <div class="form-group row">
                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="update_interval_L">update_interval_L</label>
                                        <input type="text" class="form-control" id="update_interval_L" value="3">
                                    </div>

                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="memory_M">memory_M</label>
                                        <input type="text" class="form-control" id="memory_M" value="5">
                                    </div>

                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="sample_size">sample_size</label>
                                        <input type="text" class="form-control" id="sample_size" value="5000">
                                    </div>

                                    <div class="form-group row col-md-8 offset-md-3">
                                        <label for="random_seed">random_seed</label>
                                        <input type="text" class="form-control" id="random_seed" value="null">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 control-label col-form-label"
                                    id="label_sty">save_filepath</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="file" class="form-control" name="heterolr_save_filepath"
                                        id="heterolr_save_filepath">
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="heterolr_btn"
                            onclick="getbtn(this.id)">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="evaluation" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Evaluation</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" id="evaluation_Form" action="{{url_for('#')}}" method="POST"
                            style="margin-top: 10px;margin-bottom: 0px">

                            <div class="form-group row" id="form_gro" style="display: none;">
                                <label for="#" class="col-sm-3 col-form-label" id="label_sty">module_id</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="evaluation_module_id"
                                        id="evaluation_module_id" value="">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 control-label col-form-label"
                                    id="label_sty">eval_type</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="text" class="form-control" name="evaluation_name" id="evaluation_name"
                                        value="binary">
                                </div>
                            </div>

                            <div class="form-group row" id="form_gro">
                                <label for="#" class="col-sm-3 control-label col-form-label"
                                    id="label_sty">save_filepath</label>
                                <div class="col-sm-8" id="input_sty">
                                    <input type="file" class="form-control" name="evaluation_save_filepath"
                                        id="evaluation_save_filepath">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="evaluation_btn"
                            onclick="getbtn(this.id)">保存</button>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <script type="text/javascript" src="js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>

    <script src="https://cdn.bootcdn.net/ajax/libs/jsPlumb/2.15.5/js/jsplumb.min.js"></script>

    <!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you
        wish to resize images before upload. This must be loaded before fileinput.min.js -->
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/js/plugins/piexif.min.js"
        type="text/javascript"></script>
    <!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview. 
        This must be loaded before fileinput.min.js -->
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/js/plugins/sortable.min.js"
        type="text/javascript"></script>
    <!-- popper.min.js below is needed if you use bootstrap 4.x or 5.x (for popover and tooltips). You can also use the bootstrap js 
       3.3.x versions without popper.min.js. -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- bootstrap.min.js below is needed if you wish to zoom and preview file content in a detail modal
        dialog. bootstrap 5.x or 4.x is supported. You can also use the bootstrap js 3.3.x versions. -->

    <!-- the main fileinput plugin file -->
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/js/fileinput.min.js"></script>

    <!-- optionally if you need translation for your language then include the locale file as mentioned below (replace LANG.js with your language locale) -->
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.0/js/locales/LANG.js"></script>

    <!-- <script  type="text/javascript" src="js/bootstrapValidator.min.js"></script> -->
    <!-- <script type="text/javascript"
        src="//cdn.jsdelivr.net/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script> -->

    <script src="https://cdn.bootcdn.net/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>

        $("#myForm").hide();

        // 鼠标右键事件
        $(document).contextmenu(function (e) {
            e.preventDefault() // 阻止右键菜单默认行为
            //     // console.log('this' + this)
            //     // console.log('e' + e)
            //     // console.log('e.target' + e.target)
        });

        $.fn.fileinputBsVersion = "4.3.1"; // if not set, this will be auto-derived

        $("#input_id").fileinput({
            language: 'zh',
            browseClass: "btn btn-primary",
            // showCaption: false,    //不显示标题
            showRemove: true,     //不显示删除按钮
            showUpload: false,     //不显示上传按钮
            elErrorContainer: "#errorBlock"
        });    //只显示选择文件的按钮

        var LineStyle_data = {
            //是否可以拖动（作为连线起点）
            isSource: true,
            //是否可以放置（连线终点）
            isTarget: true,
            //连线类型=>流程线：Flowchart、直线：Straight、贝塞尔：Bezier、曲线：curviness、State machine
            connector: "Flowchart",
            //端点的颜色样式
            paintStyle: { stroke: "orange" },
            //设置端点的类型，大小、css类名、浮动上去的css类名
            endpoint: ["Dot", { radius: 5, cssClass: "initial_endpoint", hoverClass: "hover_endpoint" }],
            //设置连线的颜色、粗细、间隔
            connectorStyle: { stroke: 'black', strokeWidth: "2", dashstyle: "0" },
            //设置连线hover颜色
            connectorHoverStyle: { stroke: "red" },
            // 设置端点最多可以连接几条线
            maxConnections: -1,
            // 设置连线中间的自定义节点和箭头
            connectorOverlays: [
                // ["Custom", {
                //     create: function (component) {
                //         return $("<div class='event_node'><span class='glyphicon glyphicon-plus'></span></div>");
                //     },
                //     //节点在线上的位置
                //     location: 0.5,
                //     id: "customOverlay"
                // }],
                ['Arrow', {
                    width: 20,
                    length: 12,
                    location: 1.0
                }]
            ]
        };

        var LineStyle_model = {
            //是否可以拖动（作为连线起点）
            isSource: true,
            //是否可以放置（连线终点）
            isTarget: true,
            //连线类型=>流程线：Flowchart、直线：Straight、贝塞尔：Bezier、曲线：curviness、State machine
            connector: "Flowchart",
            //端点的颜色样式
            paintStyle: { stroke: "blue" },
            //设置端点的类型，大小、css类名、浮动上去的css类名
            endpoint: ["Dot", { radius: 5, cssClass: "initial_endpoint", hoverClass: "hover_endpoint" }],
            //设置连线的颜色、粗细、间隔
            connectorStyle: { stroke: 'black', strokeWidth: "2", dashstyle: "0" },
            //设置连线hover颜色
            connectorHoverStyle: { stroke: "red" },
            // 设置端点最多可以连接几条线
            maxConnections: -1,
            // 设置连线中间的自定义节点和箭头
            connectorOverlays: [
                // ["Custom", {
                //     create: function (component) {
                //         return $("<div class='event_node'><span class='glyphicon glyphicon-plus'></span></div>");
                //     },
                //     //节点在线上的位置
                //     location: 0.5,
                //     id: "customOverlay"
                // }],
                ['Arrow', {
                    width: 20,
                    length: 12,
                    location: 1.0
                }]
            ]
        };


        $(function () {

            jsPlumb.setContainer("content");

            $(".draggable_ui").draggable({
                connectToSortable: "#content",
                helper: "clone",
                revert: "invalid",
                containment: "#content",
                scope: "dragflag"
            });

            $("#content").droppable({
                accept: '.draggable_ui',
                scope: 'dragflag',
                drop: function (event, ui) {
                    // if ($("#content").children("#" + ui.draggable[0].id).length == 0) {
                    var tt = String(ui.draggable[0].id).split('_') + '_'
                    if ($('div[id*="' + tt + '"]').length == 0) {
                        var text_id = ui.draggable[0].id + '_0'
                    } else {
                        var text_id = ui.draggable[0].id + '_' + String($('div[id*="' + tt + '"]').length)

                    }

                    $(this).append('<div class="node" style="cursor:pointer;height:80px;width:190px;background-color: ' +
                        'aqua;border: 1px solid black;display:inline-block;border-radius: 2%;text-align:center; line-height:80px;" id="' + text_id + '">'
                        + ui.draggable[0].id + '</div>');

                    jsPlumb.addEndpoint(text_id, {
                        anchor: 'Right',
                        uuid: text_id + '_Right_model_ouput'

                    }, LineStyle_model)

                    jsPlumb.addEndpoint(text_id, {
                        anchor: 'Left',
                        uuid: text_id + '_Left_model_input'

                    }, LineStyle_model)

                    jsPlumb.addEndpoint(text_id, {
                        anchor: 'Top',
                        uuid: text_id + '_Top_data_input'

                    }, LineStyle_data)

                    jsPlumb.addEndpoint(text_id, {
                        anchor: 'Bottom',
                        uuid: text_id + '_Bottom_data_output'

                    }, LineStyle_data)

                    $("#" + text_id).draggable({
                        containment: "#content",
                        scope: "dragflag", //标识
                        drag: function (event, ui) {
                            jsPlumb.repaintEverything();
                        },
                        stop: function () {
                            jsPlumb.repaintEverything();
                        }
                    });

                    var btn = document.getElementById(text_id);
                    btn.addEventListener('click', function (evt) {
                        if (confirm('确定要删除节点' + $("#" + text_id).text() + '?')) {
                            delete_node(text_id)
                            jsPlumb.revalidate("content")

                        }
                    });

                    $("#" + text_id).mousedown(function (e) {
                        //alert(e.which) // 1 = 鼠标左键 left; 2 = 鼠标中键; 3 = 鼠标右键
                        if (e.which == 3) {
                            e.preventDefault() // 阻止默认行为
                            // alert($("#" + text_id).html())
                            // alert($("#" + text_id).attr("id"))
                            show_modal_table($("#" + text_id).html(), $("#" + text_id).attr("id"))
                        }
                    });

                    // } 

                    jsPlumb.repaintEverything();
                }
            });

            function delete_node(node_id) {
                // jsPlumb.detachAllConnections(node_id);//删除divID所有连接线
                // jsPlumb.removeAllEndpoints(node_id);//删除divID所有端点
                // jsPlumb.detach(node_id);//删除连接线
                jsPlumb.remove(node_id);//移除节点
                jsPlumb.repaintEverything();
            }

            //连线样式下拉框的change事件
            $("#sel_linetype").change(function () {
                var strlinetype = "";
                var strlinecolor = "";
                var opt_val = $("#sel_linetype").val();
                jsPlumb.repaintEverything();
                //设置新添加元素的节点的连线样式
                //直线的样式和样色
                if (opt_val == "1") {
                    strlinetype = "Flowchart";
                    strlinecolor = "black";
                    LineStyle.connectorStyle = { stroke: 'black', strokeWidth: "2", dashstyle: "0" };
                    LineStyle.connector = "Flowchart"
                }
                //折线的样式和颜色
                else if (opt_val == "2") {
                    strlinetype = "Straight";
                    strlinecolor = "green";
                    LineStyle.connectorStyle = { stroke: 'green', strokeWidth: "2", dashstyle: "0" },

                        LineStyle.connector = "Straight"
                }
                //曲线的样式和颜色
                else if (opt_val == "3") {
                    strlinetype = "Bezier";
                    strlinecolor = "orange";
                    LineStyle.connectorStyle = { stroke: 'orange', strokeWidth: "2", dashstyle: "0" },
                        LineStyle.connector = "Bezier"
                }

                // 设置已经存在的所有的连接点的连线样式
                var arrnode = $("#content").find(".node");
                for (var i = 0; i < arrnode.length; i++) {
                    var arrendpoints = jsPlumb.getEndpoints($(arrnode[i]).attr("id"));
                    if (arrendpoints == undefined || arrendpoints == null) {
                        return;
                    }
                    var oconnector = arrendpoints[0].connector;
                    if (oconnector == null || oconnector == undefined) {
                        return;
                    }
                    oconnector[0] = strlinetype;
                    var oconnectstyle = arrendpoints[0].connectorStyle;
                    if (oconnectstyle == null || oconnectstyle == undefined) {
                        return;
                    }
                    oconnectstyle.strokeStyle = strlinecolor;
                }
            });

            // 请单点击一下连接线
            jsPlumb.bind('click', (conn) => {
                // if (confirm("Delete connection from " + conn.sourceId + " to " + conn.targetId + "?")) {
                //     jsPlumb.deleteConnection(conn)
                // }

                if (confirm("Delete this connection ?")) {
                    jsPlumb.deleteConnection(conn)
                }
            });

            $("#Homo_a").click(function () {
                $("#myForm").hide();
                $("#Hetero").hide();
                $("#Homo").show();

            });

            $("#Hetero_a").click(function () {
                $("#myForm").hide();
                $("#Homo").hide();
                $("#Hetero").show();

            });

            $("#Upload_data_a").click(function () {
                $("#Homo").hide();
                $("#Hetero").hide();

                // $(".node").remove();
                // $(".jtk-endpoint").remove();
                // $(".initial_endpoint").remove();
                // $(".jtk-endpoint-anchor").remove();
                // $(".jtk-draggable ").remove();
                // $(".jtk-droppable").remove();
                $("#content").find(".node").each(function (index, element) {
                    jsPlumb.remove($(element).attr('id'));//移除节点
                });
                $("#myForm").show();

            });


        });


        $("#save_btn").click(function () {

            // var nets = []
            // $("#content").find(".node").each(function (index, element) {
            //     var id = $(element).attr('id');
            //     nets[id] = {

            //         "id": $(element).attr('id'),

            //     }
            // });

            var nets = []
            $("#content").find(".node").each(function (index, element) {
                // var id = $(element).attr('id');
                nets.push($(element).attr('id'))
            });

            var node_list = []
            var concat_arr = []
            var node_left = []
            var node_right = []
            var conns = jsPlumb.getConnections()

            if (conns.length == 0) {
                return
            }
            else {
                for (var i = 0; i < conns.length; i++) {
                    concat_arr.push(conns[i].getUuids())
                    var source = conns[i].source.id;
                    var target = conns[i].target.id;
                    if (source != null && target != null) {
                        node_left.push(source)
                        node_right.push(target)
                        // node_list.push([source, target]);
                    };

                    console.log(concat_arr)

                }

                if (concat_arr != '') {
                    // concat_arr = myFunction(node_list)
                    var node_datas = { "components": {} }
                    var conn = {}

                    // var tmp = getArrDifference(node_left, node_right)
                    // var node_start = tmp[0]
                    // var node_end = tmp[1]
                    // var concat_arr = getArrConcat(node_left, node_right)
                    // console.log(concat_arr)


                    //------------------------------------------------

                    for (var i in concat_arr) {
                        var out_module_name = concat_arr[i][0].split('_', 2).join('_')
                        var in_module_name = concat_arr[i][1].split('_', 2).join('_')
                        var split_module_name = concat_arr[i][0].split('_')
                        // var module_name = split_module_name[3] + split_module_name[4]
                        if (node_datas["components"].hasOwnProperty(out_module_name)) {
                            if (split_module_name[3] == "model") {
                                if (node_datas["components"][out_module_name].hasOwnProperty('output')) {
                                    console.log('if  -----')
                                    node_datas["components"][out_module_name]["output"].model = ['model']

                                } else {
                                    node_datas["components"][out_module_name]["output"] = {
                                        "model": [
                                            "model"
                                        ]
                                    }
                                }


                            } else {


                                if (node_datas["components"][out_module_name].hasOwnProperty('output')) {
                                    console.log('else -----')
                                    node_datas["components"][out_module_name]["output"].data = ['data']
                                } else {
                                    node_datas["components"][out_module_name]["output"] = {
                                        "data": [
                                            "data"
                                        ]
                                    }
                                }

                            }
                        }
                        else {

                            // 只有输出无输入 第一个节点
                            if (node_right.indexOf(out_module_name) > -1) {
                                conn = {
                                    "module": out_module_name.split("_")[0],
                                    "input": {
                                        "data": {
                                            "data": [
                                                out_module_name + ".data"
                                            ]
                                        }
                                    },
                                    "output": {
                                        "data": [
                                            "data"
                                        ]
                                    }

                                }
                                node_datas["components"][out_module_name] = conn
                            } else {

                                if (split_module_name[3] == 'model') {
                                    conn = {
                                        "module": out_module_name.split("_")[0],
                                        "output": {
                                            "data": [
                                                "data"
                                            ],
                                            "model": [
                                                "model"
                                            ]

                                        }
                                    }
                                    node_datas["components"][out_module_name] = conn

                                } else {
                                    conn = {
                                        "module": out_module_name.split("_")[0],
                                        "output": {
                                            "data": [
                                                "data"
                                            ]

                                        }
                                    }
                                    node_datas["components"][out_module_name] = conn
                                }


                            }
                        }

                        var out_module_name = concat_arr[i][0].split('_', 2).join('_')
                        var in_module_name = concat_arr[i][1].split('_', 2).join('_')
                        var split_module_name = concat_arr[i][1].split('_')
                        // var module_name = split_module_name[3] + split_module_name[4]

                        if (node_datas["components"].hasOwnProperty(in_module_name)) {
                            if (split_module_name[3] == 'model') {
                                if (split_module_name[4] == 'input') {
                                    conn = {
                                        "model": [
                                            out_module_name + ".model"
                                        ]
                                    }
                                    node_datas["components"][in_module_name]["input"].model = [
                                        out_module_name + ".model"
                                    ]
                                }


                            } else {

                                if (split_module_name[4] == 'input') {

                                    console.log('-----')

                                    node_datas["components"][in_module_name]["input"].data = {
                                        "data": [
                                            out_module_name + ".data"
                                        ]
                                    }


                                }

                            }
                        }
                        else {

                            if (split_module_name[3] == 'model') {
                                conn = {
                                    "module": in_module_name.split("_")[0],
                                    "input": {
                                        "model": [
                                            out_module_name + ".model"
                                        ]
                                    }

                                }
                                node_datas["components"][in_module_name] = conn

                            } else {
                                conn = {
                                    "module": in_module_name.split("_")[0],
                                    "input": {
                                        "data": {
                                            "data": [
                                                out_module_name + ".data"
                                            ]
                                        }
                                    }

                                }
                                node_datas["components"][in_module_name] = conn
                            }

                            // 只有输入无输出 最后一个节点
                            if (node_left.indexOf(in_module_name) == -1) {
                                conn =
                                {
                                    "data": [
                                        "data"
                                    ]

                                }
                                node_datas["components"][in_module_name]['output'] = conn

                            }

                        }

                    }

                    var blob = new Blob([JSON.stringify(node_datas)], { type: "text/plain;charset=utf-8" });
                    saveAs(blob, "hello.json");

                }

                //------------------------------------------------

            }
        });


        $("#clear_btn").click(function () {
            $("#content").find(".node").each(function (index, element) {
                jsPlumb.remove($(element).attr('id'));
            });

        });

        // 找出两个数组的不同
        function getArrDifference(arr1, arr2) {
            return arr1.concat(arr2).filter(function (v, i, arr) {
                return arr.indexOf(v) === arr.lastIndexOf(v);
            });
        }

        // 找出两个数组的并集
        function getArrConcat(arr1, arr2) {
            return arr1.concat(arr2.filter(function (v) {
                return !(arr1.indexOf(v) > -1)
            }));

        }

        $('#sub_btn').click(function () {
            table_name = $('#table_name').val();
            namespace = $('#namespace').val();
            file_path = $('#input_id').val();

            if ($("#table_name").val().length == 0 || $("#namespace").val().length == 0 || $("#input_id").val().length == 0) {
                return
            }
            else {
                var form_data = {
                    "file": file_path,
                    "table_name": table_name,
                    "namespace": namespace,
                    "head": 1,
                    "partition": 8,
                    "work_mode": 0,
                    "backend": 0
                }

                var blob = new Blob([JSON.stringify(form_data)], { type: "text/plain;charset=utf-8" });
                saveAs(blob, "upload_data.json");
            }

        });


        function myFunction(array) {
            var componentsArray = new Array()
            var output_ = new Array()
            for (i = 0; i < array.length; i++) {
                var start = array[i][0]
                var end = array[i][1]
                if (componentsArray.indexOf(start) == -1) {
                    componentsArray.push(start)
                }
                if (componentsArray.indexOf(end) == -1) {
                    componentsArray.push(end)
                }
            }
            var len = componentsArray.length
            var graph = new Array()
            for (var x = 0; x < len; x++) {
                graph[x] = new Array();        //声明二维数组
                for (var y = 0; y < len; y++) {
                    graph[x][y] = 0;          //数组初始化为0
                }
            }
            for (i = 0; i < array.length; i++) {
                var start = array[i][0]
                var end = array[i][1]
                var rowIndex = componentsArray.indexOf(start)
                var colIndex = componentsArray.indexOf(end)
                graph[rowIndex][colIndex] = 1
            }


            //按列遍历，获取当前组件的前序组件。因为dsl中只有输入需要根据其他组件来确定
            for (i = 0; i < len; i++) {
                var input = new Array()
                for (j = 0; j < len; j++) {
                    if (graph[j][i] == 1) {
                        input.push(componentsArray[j])
                    }
                }
                // alert(componentsArray[i] + "的前序为：" + input)
                output_.push([componentsArray[i], input])

            }
            return output_


        }

        function show_modal_table(module_name, module_id) {
            console.log(module_name)
            $('#' + module_name.split("_")[0].toLowerCase()).modal('show');

            // $('#exampleModalCenter').on('show.bs.modal', function (event) {
            // var button = $(event.relatedTarget) // Button that triggered the modal
            var modal = $('#' + module_name)
            $("#" + module_name.toLowerCase() + "_save_filepath").val("");
            console.log("#" + module_name.toLowerCase() + "_save_filepath")

            //此处即为修改modal的标题
            // modal.find('.modal-title').text(module_name)
            // modal.find('.modal-body input').val(recipient)
            $('#' + module_name.toLowerCase() + "_module_id").val(module_id.toLowerCase());
            // })
        }

        function getbtn(btn_id) {
            var module_name = btn_id.split("_")[0]
            var module_id = $('#' + module_name.toLowerCase() + "_module_id").val()
            console.log('getbtn_module_name', module_name)
            console.log('getbtn_module_id', module_id)
            // if (module_name == 'heterolr') {
            //     tmp_module_name = module_name.split("l")
            //     module_name = tmp_module_name + '_lr'
            // }
            conf_dict = {
                "dsl_version": 2,
                "initiator": {
                    "role": "guest",
                    "party_id": 9999
                },
                "role": {
                    "guest": [
                        9999
                    ],
                    "host": [
                        10000
                    ],
                    "arbiter": [
                        10000
                    ]
                },
                "job_parameters": {
                    "common": {
                        "job_type": "train",
                        "backend": 0,
                        "work_mode": 1
                    }
                },
            }
            if (module_name == 'reader') {
                get_reader_data(conf_dict, module_name, module_id)

            } else if (module_name == 'dataio') {
                get_dataio_data(conf_dict, module_name, module_id)

            } else if (module_name == 'heterolr') {
                get_hetero_lr_data(conf_dict, module_name, module_id)
            } else if (module_name == 'evaluation') {
                get_evaluation_data(conf_dict, module_name, module_id)
            }
            $('#' + module_name).modal('hide');
        }

        function getjson(form_data, module_name) {
            module_id = module_name + '_save_filepath'
            var objFile = $("#" + module_id).val();
            var parse_json = {}
            console.log('------------getjson11111111111:', objFile)

            if (objFile == "") {
                alert("filepath不能为空")
                return false
            }

            else {
                var files = $("#" + module_id).prop('files');//获取到文件列表
                console.log('------------getjson2222222222222222:', objFile)
                console.log('------------getjsonfiles:', files)

                if (files.length == 0) {
                    alert('请选择文件')
                } else {
                    var reader = new FileReader();//新建一个FileReader
                    reader.readAsText(files[0], "UTF-8");//读取文件 
                    console.log('------------getjson333333333333333:', objFile)

                    reader.onload = function (evt) {
                        console.log('------------getjson:', objFile)
                        var fileString = evt.target.result; // 读取文件内容
                        parse_json = $.parseJSON(fileString)
                        deal_json_data(parse_json, form_data, module_name, objFile)
                    }
                }
            }
        }

        function deal_json_data(parse_json, form_data, module_name, objFile) {
            var module_id = form_data["module_id"]
            var Num_module = module_id.split("_")[1]
            console.log('t_module_id:', module_id)
            console.log('t_module_name:', module_name)

            if (module_name == 'reader') {
                var host = {
                    "table": {
                        "name": form_data["Host_reader_name"],
                        "namespace": form_data["Host_reader_namespace"]
                    }
                }

                var guest = {
                    "table": {
                        "name": form_data["Guest_reader_name"],
                        "namespace": form_data["Guest_reader_namespace"]
                    }
                }
                if (parse_json["component_parameters"]["role"]["host"].hasOwnProperty(Num_module)) {
                    parse_json["component_parameters"]["role"]["host"][Num_module][module_id] = host
                } else {
                    parse_json["component_parameters"]["role"]["host"][Num_module] = {}
                    parse_json["component_parameters"]["role"]["host"][Num_module][module_id] = host
                }

                if (parse_json["component_parameters"]["role"]["guest"].hasOwnProperty(Num_module)) {
                    parse_json["component_parameters"]["role"]["guest"][Num_module][module_id] = guest
                }
                else {
                    parse_json["component_parameters"]["role"]["guest"][Num_module] = {}
                    parse_json["component_parameters"]["role"]["guest"][Num_module][module_id] = guest
                }
            }
             
            else if (module_name == 'dataio') {
                var host = { "with_label": form_data["Host_dataio_namespace"] }
                var guest = { "with_label": form_data["Guest_dataio_namespace"] }


                if (parse_json["component_parameters"]["role"]["host"].hasOwnProperty(Num_module)) {
                    parse_json["component_parameters"]["role"]["host"][Num_module][module_id] = host

                } else {
                    parse_json["component_parameters"]["role"]["host"][Num_module] = {}
                    parse_json["component_parameters"]["role"]["host"][Num_module][module_id] = host
                }
                if (parse_json["component_parameters"]["role"]["guest"].hasOwnProperty(Num_module)) {
                    parse_json["component_parameters"]["role"]["guest"][Num_module][module_id] = guest

                } else {
                    parse_json["component_parameters"]["role"]["guest"][Num_module] = {}
                    parse_json["component_parameters"]["role"]["guest"][Num_module][module_id] = guest
                }

                // --------------------------------------------------------------------------------------
                var common_host = { "output_format": form_data["Host_dataio_output_format"] }
                var common_guest = { "output_format": form_data["Host_dataio_output_format"] }

                if (parse_json["component_parameters"]["common"].hasOwnProperty(module_id)) {
                    parse_json["component_parameters"]["common"][module_id] = common_host

                } else {
                    parse_json["component_parameters"]["common"][module_id] = {}
                    parse_json["component_parameters"]["common"][module_id] = common_host
                }
                // if (parse_json["component_parameters"]["common"].hasOwnProperty(module_id)) {
                //     parse_json["component_parameters"]["common"][module_id] = common_guest

                // } else {
                //     parse_json["component_parameters"]["common"][module_id] = {}
                //     parse_json["component_parameters"]["common"][module_id] = common_guest
                // }
            }

            // --------------------------------------------------------------------------------------

            else if (module_name == 'evaluation') {
                var common_host = { "eval_type": form_data["evaluation_name"] }

                if (parse_json["component_parameters"]["common"].hasOwnProperty(module_id)) {
                    parse_json["component_parameters"]["common"][module_id] = common_host
                } else {
                    parse_json["component_parameters"]["common"][module_id] = {}
                    parse_json["component_parameters"]["common"][module_id] = common_host
                }

            }

            // --------------------------------------------------------------------------------------

            else if (module_name == 'heterolr') {
                if (module_name == 'heterolr') {
                    _module_id = module_id.split("l")
                    t_module_id = module_id.split("_")  //heterolr_0
                    module_id = _module_id[0] + '_lr_' + t_module_id[1]
                }
                var common_host = {
                    "penalty": form_data["heterolr_penalty"],
                    "tol": form_data["heterolr_tol"],
                    "alpha": form_data["heterolr_alpha"],
                    "optimizer": form_data["heterolr_optimizer"],
                    "batch_size": form_data["heterolr_batch_size"],
                    "learning_rate": form_data["heterolr_learning_rate"],
                    "init_param": {
                        "init_method": form_data["init_method"]
                    },
                    "max_iter": form_data["heterolr_max_iter"],
                    "early_stop": form_data["heterolr_early_stop"],
                    "cv_param": {
                        "n_splits": form_data["n_splits"],
                        "shuffle": form_data["shuffle"],
                        "random_seed": form_data["random_seed"],
                        "need_cv": form_data["need_cv"]
                    },
                    "sqn_param": {
                        "update_interval_L": form_data["update_interval_L"],
                        "memory_M": form_data["memory_M"],
                        "sample_size": form_data["sample_size"],
                        "random_seed": form_data["random_seed"]
                    }
                }

                if (parse_json["component_parameters"]["common"].hasOwnProperty(module_id)) {
                    parse_json["component_parameters"]["common"][module_id] = common_host
                } else {
                    parse_json["component_parameters"]["common"][module_id] = {}
                    parse_json["component_parameters"]["common"][module_id] = common_host
                }

            }

            var blob = new Blob([JSON.stringify(parse_json)], { type: "text/plain;charset=utf-8" });
            saveAs(blob, objFile);
        }

        function get_reader_data(conf_dict, module_name, module_id) {
            Host_reader_name = $('#Host_reader_name').val()
            Host_reader_namespace = $('#Host_reader_namespace option:selected').val()
            Guest_reader_name = $('#Guest_reader_name').val()
            Guest_reader_namespace = $('#Guest_reader_namespace option:selected').val()

            var reader_data = {
                'module_id': module_id,
                'Host_reader_name': Host_reader_name,
                'Host_reader_namespace': Host_reader_namespace,
                'Guest_reader_name': Guest_reader_name,
                'Guest_reader_namespace': Guest_reader_namespace
            }
            getjson(reader_data, 'reader')

        }

        function get_dataio_data(conf_dict, module_name, module_id) {
            Host_dataio_namespace = $('#Host_dataio_namespace option:selected').val()
            Host_dataio_output_format = $('#Host_dataio_output_format').val()
            Guest_dataio_namespace = $('#Guest_dataio_namespace option:selected').val()
            Guest_dataio_output_format = $('#Guest_dataio_output_format').val()

            var dataio_data = {
                'module_id': module_id,
                'Host_dataio_namespace': Host_dataio_namespace,
                'Host_dataio_output_format': Host_dataio_output_format,
                'Guest_dataio_namespace': Guest_dataio_namespace,
                'Guest_dataio_output_format': Guest_dataio_output_format
            }
            console.log('----------get_dataio_data')
            getjson(dataio_data, 'dataio')

        }

        function get_hetero_lr_data(conf_dict, module_name, module_id) {
            heterolr_penalty = $('#heterolr_penalty').val()
            heterolr_tol = $('#heterolr_tol').val()
            heterolr_alpha = $('#heterolr_alpha').val()
            heterolr_optimizer = $('#heterolr_optimizer').val()
            heterolr_batch_size = $('#heterolr_batch_size').val()
            heterolr_learning_rate = $('#heterolr_learning_rate').val()
            heterolr_max_iter = $('#heterolr_max_iter').val()
            heterolr_early_stop = $('#heterolr_early_stop').val()
            init_method = $('#init_method').val()
            n_splits = $('#n_splits').val()
            need_cv = $('#need_cv option:selected').val()
            random_seed = $('#random_seed').val()
            shuffle = $('#shuffle option:selected').val()
            update_interval_L = $('#update_interval_L').val()
            memory_M = $('#memory_M').val()
            sample_size = $('#sample_size').val()
            random_seed = $('#random_seed').val()

            var hetero_lr_data = {
                'module_id': module_id,
                'heterolr_penalty': heterolr_penalty,
                'heterolr_tol': heterolr_tol,
                'heterolr_alpha': heterolr_alpha,
                'heterolr_optimizer': heterolr_optimizer,
                'heterolr_batch_size': heterolr_batch_size,
                'heterolr_learning_rate': heterolr_learning_rate,
                'heterolr_max_iter': heterolr_max_iter,
                'heterolr_early_stop': heterolr_early_stop,
                'init_method': init_method,
                'n_splits': n_splits,
                'need_cv': need_cv,
                'random_seed': random_seed,
                'shuffle': shuffle,
                'update_interval_L': update_interval_L,
                'memory_M': memory_M,
                'sample_size': sample_size,
                'random_seed': random_seed
            }
            getjson(hetero_lr_data, 'heterolr')

        }

        function get_evaluation_data(conf_dict, module_name, module_id) {
            evaluation_name = $('#evaluation_name').val()
            var evaluation_data = {
                'module_id': module_id,
                'evaluation_name': evaluation_name,
            }
            getjson(evaluation_data, 'evaluation')

        }


    </script>
</body>

</html>